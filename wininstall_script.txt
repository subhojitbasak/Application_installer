#!/bin/bash

###########################################
#Generate installed program list on windows
wmic product get name,version > C:\Users\Subhojit\Documents\programsInstalled\listOfProgramsInstalledWin10.txt
#serch file name

log(){
	local level = "$1"
	local message = "$2"
	echo "$(date '+%Y-%m-%d %H:%M:%S') [$level]  = $message | tee -a "LOG_FILE"
}

run_installation(){
	local state=$1
	local APP=$2
	if [$state -eq "UPGRADE"] then
		winget upgrade $APP
	elif [$state -eq "INSTALL"] then
		winget install $APP
	fi
}

#while true ;do

#Read app name from your custom list

APP_NM=
#Check application is installed or not
if[present]
then
	#Find Installed version of the APP 
	INSTALLED_VERSION = Select-String -Path "C:\Users\Subhojit\Documents\listOfProgramsInstalledWin10.txt" -Pattern "$APP_NM" | ForEach-Object { $_.Line -replace '.*\s(\d+\.\d+\.\d+\.\d+).*', '$1' }
	if [$INSTALLED_VERSION -eq 0]; then
	
	#file is not present in the server
	run_installation "INSTALL" "$APP_NM"
	log "INFO" "Application installed sucessfully!!"
else
	log "INFO" "File already installed , running upgrade script"
	run_installation "UPGRADE" "$APP_NM"
	log "INFO" "Application updated sucessfully!!"
	break


#done
